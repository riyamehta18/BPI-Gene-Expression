---
title: "QBS103 Final Project"
output: html_document
date: "2023-07-23"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(ggthemes)
library(ggpubr)
library(gridExtra)
library(dplyr)
```

```{r}
metadata <- read.csv("QBS103_finalProject_metadata.csv", row.names = 1)
gene_exp <- read.csv("QBS103_finalProject_geneExpression.csv", row.names = 1)
```


```{r}
#chosen gene: BPI - bactericidal permeability increasing protein - Plays a role in the immune response against bacterial infections, can kill the bacterial by targeting their cell membrane and can also increase permeability of cell membranes, encodes a lipopolysaccharide binding protein and helps with regulating inflammatory responses

BPI <- gene_exp["BPI",]
BPI <- as.data.frame(t(BPI)) #transposes the matrix
metadata_BPI <- cbind(metadata, BPI) #creates one data frame with all BPI data
suppressWarnings(metadata_BPI$age <- as.integer(metadata_BPI$age))
```

```{r}
#creates histogram of BPI

ggplot(metadata_BPI, aes(x = BPI)) + geom_histogram(color = "#6794a7", fill = "white", bins = 50) + 
  labs(x = "Gene Expression Levels of BPI", y = "Frequency of Occurrence", title = "Distribution of Gene Expression Levels for BPI") + 
  theme_economist() + 
  scale_fill_economist() + 
  theme(plot.title = element_text(size=15, face="bold", margin = margin(10, 0, 10, 0), hjust = (0.5)), axis.title.x = element_text(vjust=-0.40), axis.title.y= element_text(vjust=2 ))

# interpretation - shows the distribution of BPI gene expression in the samples. there are more studies with lower gene expression levels of BPI with a smaller amount of samples showing higher levels of expression levels. the majority of samples are seen below the threshold of 200.
```

```{r}
#chosen continuous covariate: age

#creates scatterplot with BPI and age
suppressWarnings(scatter_outliers <- ggplot(metadata_BPI, aes(x = BPI, y = age)) + 
  geom_point(color = "#6794a7", fill = "white") + 
  labs(x = "Gene Expression Levels of BPI", y = "Age") + 
  theme_economist() + 
  scale_fill_economist() + 
  theme(plot.title = element_text(size=12, face="bold", margin = margin(10, 0, 10, 0)), axis.title.x = element_text(vjust=-0.40), axis.title.y= element_text(vjust=2)))

#creates scatterplot with BPI and age and sets x-axis range from 0 to 150 for easier viewing
suppressWarnings(scatter_no_outliers <- ggplot(metadata_BPI, aes(x = BPI, y = age)) + 
  geom_point(color = "#6794a7", fill = "white") + 
  labs(x = "Gene Expression Levels of BPI", y = "Age") + 
  theme_economist() + 
  scale_fill_economist() + 
  theme(plot.title = element_text(size=12, face="bold", margin = margin(10, 0, 10, 0)), axis.title.x = element_text(vjust=-0.40), axis.title.y= element_text(vjust=2)) + 
  xlim(0, 150))

#creates scatterplot of both previous plots combined
suppressWarnings(new_scatter <- ggarrange(scatter_outliers, scatter_no_outliers,ncol=2, labels = c("A: Outliers Included", "B: Outliers Excluded"))) 

#adds title to the combined plot
suppressWarnings(annotate_figure(new_scatter, top = text_grob("Gene Expression Levels of BPI vs. Age", color = "#6794a7", face = "bold", size = 14)))

#interpretation - shows the relationship between BPI gene expression and ages of individuals sampled. there is not necessarily a clear relationship that can be observed in this graph without further analysis. the points seem to be clustered towards the lower gene expression levels around ages 50-85.
```

```{r}
#chosen categorical covariates: sex and mechanical ventilation

#create new dataset with the row of data where sex = "unknown"
unknown_removed <- metadata_BPI
unknown_removed <- metadata_BPI[metadata_BPI$sex != " unknown", ]

#creates scatterplot with BPI, sex, and mechanical ventilation
suppressWarnings(box_outliers <- ggplot(unknown_removed,aes(x = sex,y = BPI, color = mechanical_ventilation)) + geom_boxplot() + scale_x_discrete(labels = c("Female", "Male")) + labs(x = "Sex", y = "Gene Expression Levels of BPI", color = "Mechanical Ventilation") + theme_economist() + scale_color_manual(values = c('#014d64','#6794a7')) + theme(plot.title = element_text(size=15, face="bold", margin = margin(10, 0, 10, 0), hjust = (0.5)), axis.title.x = element_text(vjust=-0.40), axis.title.y= element_text(vjust=2))) 

#creates scatterplot with BPI, sex, and mechanical ventilation and sets y-axis range from 0 to 200 for easier viewing
suppressWarnings(box_no_outliers <- ggplot(unknown_removed,aes(x = sex,y = BPI, color = mechanical_ventilation)) + geom_boxplot() + scale_x_discrete(labels = c("Female", "Male")) + labs(x = "Sex", y = "Gene Expression Levels of BPI", color = "Mechanical Ventilation") + theme_economist() + scale_color_manual(values = c('#014d64','#6794a7')) + theme(plot.title = element_text(size=15, face="bold", margin = margin(10, 0, 10, 0), hjust = (0.5)), axis.title.x = element_text(vjust=-0.40), axis.title.y= element_text(vjust=2)) + ylim(0, 200))

#creates boxplot of both previous plots combined
suppressWarnings(new_box <- ggarrange(box_outliers, box_no_outliers,ncol=2, labels = c("A: Outliers Included", "B: Outliers Excluded")))

#adds title to the combined plot
annotate_figure(new_box, top = text_grob("BPI Expression by Sex and Mechanical Ventilation", color = "#6794a7", face = "bold", size = 14))

#interpretation - shows distribution of BPI gene expression across sexes and ventilation categories. from the graph on the right, we can see that the samples with mechanical ventilation have a higher mean gene expression level. this is true for both males and females. the mechanical ventilation groups have a higher iqr when compared to the groups without mechanical ventilation. the females from the study seem to have a higher mean gene expression level than the males.
```
